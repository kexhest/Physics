!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Physics=e():t.Physics=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(7)},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(2),a=n(o),u=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];r(this,t);var i=arguments.length<=1||void 0===arguments[1]?0:arguments[1];this.x=e,this.y=i}return s(t,[{key:"set",value:function(t,e){return this.x=t||0,this.y=e||0,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clear",value:function(){return this.x=0,this.y=0,this}},{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"add",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addSelf",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"sub",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"subSelf",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"multiplySelf",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divideScalar",value:function(t){return t?(this.x/=t,this.y/=t):this.set(0,0),this}},{key:"negate",value:function(){return this.multiplyScalar(-1)}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return a.sqrt(this.lengthSquared())}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"distanceTo",value:function(t){return a.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"equals",value:function(t){return this.distanceTo(t)<1e-4}},{key:"lerp",value:function(t,e){var i=(t.x-this.x)*e+this.x,n=(t.y-this.y)*e+this.y;return this.set(i,n)}},{key:"isZero",value:function(){return this.length()<1e-4}}]),t}();e["default"]=u},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.max=Math.max,e.sqrt=Math.sqrt},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),u=r(a),l=i(2),c=n(l),h=function(){function t(e,i,n,r){s(this,t),this.a=e,this.b=i,this.constant=n,this.on=!0,this.distanceMin=r,this.distanceMinSquared=r*r}return o(t,[{key:"update",value:function(){var t=this.a,e=this.b;if(!(!this.on||t.fixed&&e.fixed)){var i=(new u["default"]).sub(t.position,e.position),n=c.max(i.lengthSquared(),this.distanceMinSquared),r=this.constant*t.mass*e.mass/n,s=c.sqrt(n);return 0===r||0===s?i.clear():i.divideScalar(s).multiplyScalar(r),t.fixed||t.force.subSelf(i),e.fixed||e.force.addSelf(i),this}}},{key:"resting",value:function(){var t=this.a,e=this.b,i=this.distanceMin;return!this.on||t.fixed&&e.fixed||t.fixed&&e.position.distanceTo(t.position)<=i&&e.resting()||e.fixed&&t.position.distanceTo(e.position)<=i&&t.resting()}}]),t}();e["default"]=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),a=n(o),u=function(){function t(e){r(this,t),this.system=e,this.originalPositions=[],this.originalVelocities=[],this.k1Forces=[],this.k1Velocities=[],this.k2Forces=[],this.k2Velocities=[],this.k3Forces=[],this.k3Velocities=[],this.k4Forces=[],this.k4Velocities=[]}return s(t,[{key:"allocateParticles",value:function(){for(;this.system.particles.length>this.originalPositions.length;)this.originalPositions.push(new a["default"]),this.originalVelocities.push(new a["default"]),this.k1Forces.push(new a["default"]),this.k1Velocities.push(new a["default"]),this.k2Forces.push(new a["default"]),this.k2Velocities.push(new a["default"]),this.k3Forces.push(new a["default"]),this.k3Velocities.push(new a["default"]),this.k4Forces.push(new a["default"]),this.k4Velocities.push(new a["default"]);return this}},{key:"step",value:function(t){var e=this.system;this.allocateParticles();for(var i=0;i<e.particles.length;i++){var n=e.particles[i];n.fixed||(this.originalPositions[i].copy(n.position),this.originalVelocities[i].copy(n.velocity)),n.force.clear()}e.applyForces();for(var i=0;i<e.particles.length;i++){var n=e.particles[i];n.fixed||(this.k1Forces[i].copy(n.force),this.k1Velocities[i].copy(n.velocity)),n.force.clear()}for(var i=0;i<e.particles.length;i++){var n=e.particles[i];if(!n.fixed){var r=this.originalPositions[i],s=this.k1Velocities[i],o=r.x+.5*s.x*t,a=r.y+.5*s.y*t;n.position.set(o,a);var u=this.originalVelocities[i],l=this.k1Forces[i];o=u.x+.5*l.x*t/n.mass,a=u.y+.5*l.y*t/n.mass,n.velocity.set(o,a)}}e.applyForces();for(var i=0;i<e.particles.length;i++){var n=e.particles[i];n.fixed||(this.k2Forces[i].copy(n.force),this.k2Velocities[i].copy(n.velocity)),n.force.clear()}for(var i=0;i<e.particles.length;i++){var n=e.particles[i];if(!n.fixed){var r=this.originalPositions[i],c=this.k2Velocities[i];n.position.set(r.x+.5*c.x*t,r.y+.5*c.y*t);var u=this.originalVelocities[i],h=this.k2Forces[i];n.velocity.set(u.x+.5*h.x*t/n.mass,u.y+.5*h.y*t/n.mass)}}e.applyForces();for(var i=0;i<e.particles.length;i++){var n=e.particles[i];n.fixed||(this.k3Forces[i].copy(n.force),this.k3Velocities[i].copy(n.velocity)),n.force.clear()}for(var i=0;i<e.particles.length;i++){var n=e.particles[i];if(!n.fixed){var r=this.originalPositions[i],f=this.k3Velocities[i];n.position.set(r.x+f.x*t,r.y+f.y*t);var u=this.originalVelocities[i],p=this.k3Forces[i];n.velocity.set(u.x+p.x*t/n.mass,u.y+p.y*t/n.mass)}}e.applyForces();for(var i=0;i<e.particles.length;i++){var n=e.particles[i];n.fixed||(this.k4Forces[i].copy(n.force),this.k4Velocities[i].copy(n.velocity))}for(var i=0;i<e.particles.length;i++){var n=e.particles[i];if(n.age+=t,!n.fixed){var r=this.originalPositions[i],s=this.k1Velocities[i],c=this.k2Velocities[i],f=this.k3Velocities[i],d=this.k4Velocities[i],o=r.x+t/6*(s.x+2*c.x+2*f.x+d.x),a=r.y+t/6*(s.y+2*c.y+2*f.y+d.y);n.position.set(o,a);var u=this.originalVelocities[i],l=this.k1Forces[i],h=this.k2Forces[i],p=this.k3Forces[i],y=this.k4Forces[i];o=u.x+t/(6*n.mass)*(l.x+2*h.x+2*p.x+y.x),a=u.y+t/(6*n.mass)*(l.y+2*h.y+2*p.y+y.y),n.velocity.set(o,a)}}return this}}]),t}();e["default"]=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),a=n(o),u=function(){function t(e,i,n){r(this,t),this.position=new a["default"](i,n),this.velocity=new a["default"],this.force=new a["default"],this.mass=e,this.fixed=!1,this.age=0,this.dead=!1}return s(t,[{key:"distanceTo",value:function(t){return this.position.distanceTo(t.position)}},{key:"makeFixed",value:function(){return this.fixed=!0,this.velocity.clear(),this}},{key:"reset",value:function(){return this.clear(),this.velocity.clear(),this.force.clear(),this.mass=1,this.age=0,this.dead=!1,this}},{key:"resting",value:function(){return this.fixed||this.velocity.isZero()&&this.force.isZero()}}]),t}();e["default"]=u},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function r(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),u=r(a),l=i(5),c=r(l),h=i(8),f=r(h),p=i(3),d=r(p),y=i(4),v=r(y),g=i(9),m=n(g),k=0,x=.001,b=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?k:arguments[0],i=arguments.length<=1||void 0===arguments[1]?k:arguments[1];s(this,t);var n=arguments.length<=2||void 0===arguments[2]?x:arguments[2];this.equilibriumCriteria={particles:!0,springs:!0,attractions:!0},this.equilibrium=!1,this.optimized=!1,this.particles=[],this.springs=[],this.attractions=[],this.forces=[],this.integrator=new v["default"](this),this.hasDeadParticles=!1,this.Attraction=d["default"],this.Integrator=v["default"],this.Particle=c["default"],this.Spring=f["default"],this.Vector=u["default"],this.DEFAULT_GRAVITY=k,this.DEFAULT_DRAG=x,this.gravity=new u["default"](e,i),this.drag=n}return o(t,[{key:"optimize",value:function(t){return this.optimized=!!t,this}},{key:"setGravity",value:function(t,e){return this.gravity.set(t,e),this}},{key:"setEquilibriumCriteria",value:function(t,e,i){this.equilibriumCriteria.particles=!!t,this.equilibriumCriteria.springs=!!e,this.equilibriumCriteria.attractions=!!i}},{key:"tick",value:function(){return this.integrator.step(0===arguments.length?1:arguments[0]),this.optimized&&(this.equilibrium=!this.needsUpdate()),this}},{key:"needsUpdate",value:function(){if(this.equilibriumCriteria.particles)for(var t=0;t<this.particles.length;t++)if(!this.particles[t].resting())return!0;if(this.equilibriumCriteria.springs)for(var t=0;t<this.springs.length;t++)if(!this.springs[t].resting())return!0;if(this.equilibriumCriteria.attractions)for(var t=0;t<this.attractions.length;t++)if(!this.attractions[t].resting())return!0;return!1}},{key:"addParticle",value:function(t){return this.particles.push(t),this}},{key:"addSpring",value:function(t){return this.springs.push(t),this}},{key:"addAttraction",value:function(t){return this.attractions.push(t),this}},{key:"makeParticle",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?0:arguments[1],i=arguments.length<=2||void 0===arguments[2]?0:arguments[2],n=m.isNumeric(t)?t:1,r=new c["default"](n,e,i);return this.addParticle(r),r}},{key:"makeSpring",value:function(t,e,i,n,r){var s=new f["default"](t,e,i,n,r);return this.addSpring(s),s}},{key:"makeAttraction",value:function(t,e,i,n){var r=new d["default"](t,e,i,n);return this.addAttraction(r),r}},{key:"clear",value:function(){this.particles.length=0,this.springs.length=0,this.attractions.length=0}},{key:"applyForces",value:function(){if(!this.gravity.isZero())for(var t=0;t<this.particles.length;t++)this.particles[t].force.addSelf(this.gravity);for(var e=new u["default"],t=0;t<this.particles.length;t++){var i=this.particles[t];e.set(-1*i.velocity.x*this.drag,-1*i.velocity.y*this.drag),i.force.addSelf(e)}for(var t=0;t<this.springs.length;t++)this.springs[t].update();for(var t=0;t<this.attractions.length;t++)this.attractions[t].update();for(var t=0;t<this.forces.length;t++)this.forces[t].update();return this}},{key:"clearForces",value:function(){for(var t=0;t<this.particles.length;t++)this.particles[t].clear();return this}}]),t}();e["default"]=b},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var u=i(12),l=n(u),c=i(6),h=n(c),f=function(t){function e(t,i,n){r(this,e);var o=s(this,Object.getPrototypeOf(e).call(this,t,i,n));return o.playing=!1,o.animations=[],o.equilibriumCallbacks=[],o.loop(),o}return o(e,t),a(e,[{key:"play",value:function(){return this.playing?this:(this.playing=!0,this.equilibrium=!1,this)}},{key:"pause",value:function(){return this.playing=!1,this}},{key:"toggle",value:function(){return this.playing?this.pause():this.play(),this}},{key:"onUpdate",value:function(t){return this.animations.indexOf(t)>=0||"function"!=typeof t?this:(this.animations.push(t),this)}},{key:"onEquilibrium",value:function(t){return this.equilibriumCallbacks.indexOf(t)>=0||"function"!=typeof t?this:(this.equilibriumCallbacks.push(t),this)}},{key:"update",value:function(){if(this.optimized&&this.equilibrium)return this;this.tick();for(var t=0;t<this.animations.length;t++)this.animations[t]();return this}},{key:"loop",value:function(){this.playing&&this.update(),(0,l["default"])(this.loop.bind(this))}}]),e}(h["default"]);e["default"]=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),a=n(o),u=function(){function t(e,i,n,s,o){r(this,t),this.a=e,this.b=i,this.constant=n,this.damping=s,this.length=o,this.on=!0}return s(t,[{key:"currentLength",value:function(){return this.a.position.distanceTo(this.b.position)}},{key:"update",value:function(){var t=this.a,e=this.b;if(!this.on||t.fixed&&e.fixed)return this;var i=(new a["default"]).sub(t.position,e.position),n=i.length();0===n?i.clear():i.divideScalar(n);var r=-1*(n-this.length)*this.constant,s=(new a["default"]).sub(t.velocity,e.velocity),o=-1*this.damping*s.dot(i),u=r+o;return i.multiplyScalar(u),t.fixed||t.force.addSelf(i),e.fixed||e.force.subSelf(i),this}},{key:"resting",value:function(){var t=this.a,e=this.b,i=this.length;return!this.on||t.fixed&&e.fixed||t.fixed&&(0===i?e.position.equals(t.position):e.position.distanceTo(t.position)<=i)&&e.resting()||e.fixed&&(0===i?t.position.equals(e.position):t.position.distanceTo(e.position)<=i)&&t.resting()}}]),t}();e["default"]=u},function(t,e){"use strict";function i(t){return!isNaN(parseFloat(t))&&isFinite(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.isNumeric=i},function(t,e,i){(function(e){(function(){var i,n,r;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:"undefined"!=typeof e&&null!==e&&e.hrtime?(t.exports=function(){return(i()-r)/1e6},n=e.hrtime,i=function(){var t;return t=n(),1e9*t[0]+t[1]},r=i()):Date.now?(t.exports=function(){return Date.now()-r},r=Date.now()):(t.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(e,i(11))},function(t,e){function i(){l=!1,o.length?u=o.concat(u):c=-1,u.length&&n()}function n(){if(!l){var t=setTimeout(i);l=!0;for(var e=u.length;e;){for(o=u,u=[];++c<e;)o&&o[c].run();c=-1,e=u.length}o=null,l=!1,clearTimeout(t)}}function r(t,e){this.fun=t,this.array=e}function s(){}var o,a=t.exports={},u=[],l=!1,c=-1;a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new r(t,e)),1!==u.length||l||setTimeout(n,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=s,a.addListener=s,a.once=s,a.off=s,a.removeListener=s,a.removeAllListeners=s,a.emit=s,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,e,i){for(var n=i(10),r="undefined"==typeof window?{}:window,s=["moz","webkit"],o="AnimationFrame",a=r["request"+o],u=r["cancel"+o]||r["cancelRequest"+o],l=0;l<s.length&&!a;l++)a=r[s[l]+"Request"+o],u=r[s[l]+"Cancel"+o]||r[s[l]+"CancelRequest"+o];if(!a||!u){var c=0,h=0,f=[],p=1e3/60;a=function(t){if(0===f.length){var e=n(),i=Math.max(0,p-(e-c));c=i+e,setTimeout(function(){var t=f.slice(0);f.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(c)}catch(i){setTimeout(function(){throw i},0)}},Math.round(i))}return f.push({handle:++h,callback:t,cancelled:!1}),h},u=function(t){for(var e=0;e<f.length;e++)f[e].handle===t&&(f[e].cancelled=!0)}}t.exports=function(t){return a.call(r,t)},t.exports.cancel=function(){u.apply(r,arguments)}}])});